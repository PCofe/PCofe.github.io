<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>hexo-next 搭建</title>
    <url>/PeanutCofe/hexo-next.html</url>
    <content><![CDATA[<h2 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h2><h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><p>hexo 是一个快速、简洁且高效的博客web框架。<a href="https://hexo.io/zh-cn/">安装</a> 参考官网：<a href="https://theme-next.js.org/">https://theme-next.js.org/</a></p>
<span id="more"></span>

<p>如果<code>npm install -g hexo-cli</code> 安装时 block，可加上 <code> --registry=https://registry.npm.taobao.org</code> </p>
<p>完整命令：</p>
<p><code> npm install -g hexo-cli --registry=https://registry.npm.taobao.org</code></p>
<h3 id="tip-hexo"><a href="#tip-hexo" class="headerlink" title="tip hexo"></a>tip hexo</h3><p><code>hexo</code>使用命令不再称述，可通过 <code>npx hexo help</code>查阅。</p>
<p>使用时可能需要注意：</p>
<ol>
<li><code>npx hexo init</code>  必须保证整个目前为空，不能有<code>.</code>隐藏文件、目录；最好直接创建一个新的目录</li>
<li><code>npx hexo s --debug</code> 调试页面出现<code>&#123;% extends ‘_layout.swig‘ %&#125;... </code>错误，因为hexo 5.0之后不再提供<code>swig</code>插件，需要手动安装 <code>npm i hexo-renderer-swig</code></li>
</ol>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>建议将原有的URL生成规则修改，</p>
<ul>
<li><p>安装插件<code>npm install hexo-abbrlink --save</code></p>
</li>
<li><p>修改<code>hexo</code>配置：</p>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># permalink: :year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:abbrlink.html</span>  <span class="comment"># 可自定前后缀</span></span><br><span class="line">	<span class="attr">alg:</span> <span class="string">crc16</span></span><br><span class="line">	<span class="attr">rep:</span> <span class="string">dec</span></span><br></pre></td></tr></table></figure>

<p>如果某篇文章需要自定义 URL，也可以在文章中配置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">hexo-next</span> <span class="string">搭建</span></span><br><span class="line"><span class="attr">date:</span> </span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="attr">abbrlink:</span> <span class="string">hexo-next</span></span><br></pre></td></tr></table></figure>



<h2 id="Next"><a href="#Next" class="headerlink" title="Next"></a>Next</h2><p><code>next</code>主题安装可参考：<a href="https://theme-next.iissnan.com/getting-started.html">https://theme-next.iissnan.com/getting-started.html</a></p>
<p>可供参考配置：</p>
<ul>
<li><p>本地搜索：</p>
<p>  安装插件：<code>npm install hexo-generator-searchdb</code></p>
  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">local_search:</span></span><br><span class="line">	<span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>tag</code>图标</p>
  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">tag_icon:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>评论</p>
  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">	<span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>为了方便将主题修改后上传github，下载一插件: <code>npm install hexo-deployer-git --save</code></p>
<p>在hexo配置文件中修改:</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:your</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p><code>repo</code> 建议使用ssh方式</p>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>写md一般使用<code>typora</code>，其图片规则又与原本 hexo 方式并不一致，考虑到后续还会花很多时间来将md迁移到hexo下就感到麻烦；文章多、时间长就更没有精力来同步一遍，所以简单写了一个脚本来自动同步。</p>
<p><code>typora</code>图片方式：图片复制到当前文件夹下</p>
<p><code>hexo </code> 开启图片</p>
<p>b_blog 脚本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"></span><br><span class="line">IFS_OLD=<span class="variable">$IFS</span></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 2 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">		<span class="comment"># 自定义路径</span></span><br><span class="line">    <span class="comment"># blog_path=&quot;/Users/weigong/PCofe/source/blog/markdown&quot;</span></span><br><span class="line">    blog_path=<span class="string">&quot;/Users/weigong/Library/Mobile Documents/com~apple~CloudDocs/doc/&quot;</span></span><br><span class="line">    hexo_path=<span class="string">&#x27;/Users/weigong/PCofe/source/blog/PCofe.github.io/source/_posts&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    blog_path=<span class="variable">$1</span></span><br><span class="line">    hexo_path=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ForDir</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> `<span class="built_in">ls</span> <span class="variable">$1</span>`</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">test</span> -d <span class="string">&quot;<span class="variable">$1</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            ForDir <span class="string">&quot;<span class="variable">$1</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;file&#125;</span>&quot;</span> == *.md ]]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                image_name=`<span class="built_in">echo</span> <span class="variable">$&#123;file%*.md&#125;</span>`</span><br><span class="line">                <span class="built_in">echo</span> <span class="variable">$&#123;image_name&#125;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 忽略不需要构建的md，可将 ignore 加在 title栏的定义中</span></span><br><span class="line">                ignore=`rg -e <span class="string">&#x27;^[iI]gnore: true&#x27;</span> <span class="string">&quot;<span class="variable">$1</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span> | <span class="built_in">wc</span> -l`</span><br><span class="line">                <span class="keyword">if</span> [ <span class="variable">$&#123;ignore&#125;</span> -ne 0 ]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;ignore <span class="variable">$1</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">continue</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$1</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span> | sed  <span class="string">&#x27;s/!\[\(.*\)\](\(.*\))/&#123;% asset_img \2 \1 %&#125;/g&#x27;</span> &gt;  <span class="string">&quot;<span class="variable">$&#123;hexo_path&#125;</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span></span><br><span class="line">                <span class="comment"># 忽略掉不需要显示的字段</span></span><br><span class="line">                sed -i <span class="string">&#x27;&#x27;</span> <span class="string">&#x27;s/^[iI]gnore:.*$//g&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;hexo_path&#125;</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">cd</span> <span class="variable">$&#123;hexo_path&#125;</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">                <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$&#123;hexo_path&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>&quot;</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">                <span class="built_in">cd</span> - &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                img_files=`rg  -l --max-depth 1 <span class="string">&quot;<span class="variable">$&#123;file&#125;</span>&quot;</span>`</span><br><span class="line">                <span class="keyword">for</span> img_in_name <span class="keyword">in</span> <span class="variable">$&#123;img_files&#125;</span></span><br><span class="line">                <span class="keyword">do</span></span><br><span class="line">                		<span class="comment"># 忽略不需要构建的md</span></span><br><span class="line">                    ignore=`rg -e <span class="string">&#x27;^[iI]gnore: true&#x27;</span> <span class="string">&quot;<span class="variable">$1</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span> | <span class="built_in">wc</span> -l`</span><br><span class="line">                    <span class="keyword">if</span> [ <span class="variable">$&#123;ignore&#125;</span> -ne 0 ]</span><br><span class="line">                    <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">continue</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">                    image_name=`<span class="built_in">echo</span> <span class="variable">$&#123;img_in_name%*.md&#125;</span>`</span><br><span class="line">                    <span class="built_in">cd</span> <span class="variable">$&#123;hexo_path&#125;</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">                    <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$&#123;hexo_path&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>&quot;</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">                    <span class="built_in">cp</span> -f <span class="string">&quot;<span class="variable">$1</span>/<span class="variable">$&#123;file&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;hexo_path&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>&quot;</span></span><br><span class="line">                    <span class="built_in">cd</span> - &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">                <span class="keyword">done</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ForDir <span class="variable">$&#123;blog_path&#125;</span></span><br><span class="line"></span><br><span class="line">IFS=<span class="variable">$&#123;IFS_OLD&#125;</span></span><br></pre></td></tr></table></figure>

<p>还有一个比较简单的build脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span>  ~/PCofe/source/blog/PCofe.github.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面脚本</span></span><br><span class="line">b_blog </span><br><span class="line"></span><br><span class="line">npx hexo clean</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;debug&quot;</span>  ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    npx hexo s --debug</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    npx hexo g</span><br><span class="line">    npx hexo d</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure>

<p>建议将两个脚本放入<code>~/bin</code></p>
]]></content>
      <categories>
        <category>记录 环境</category>
      </categories>
      <tags>
        <tag>环境</tag>
      </tags>
  </entry>
</search>
